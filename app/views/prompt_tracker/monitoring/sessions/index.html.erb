<% content_for :breadcrumbs do %>
  <li class="breadcrumb-item"><%= link_to "Monitoring", monitoring_root_path %></li>
  <li class="breadcrumb-item active">Sessions</li>
<% end %>

<div class="row mb-4">
  <div class="col">
    <h1>
      <i class="bi bi-collection"></i> Sessions
      <span class="badge bg-secondary"><%= @sessions.total_count %></span>
    </h1>
    <p class="text-muted">Browse all tracing sessions with their execution traces</p>
  </div>
</div>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: monitoring_sessions_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-3">
        <%= f.label :user_id, "User", class: "form-label" %>
        <%= f.select :user_id, options_for_select(@users, params[:user_id]),
            { include_blank: "All Users" },
            class: "form-select" %>
      </div>

      <div class="col-md-3">
        <%= f.label :start_date, "Start Date", class: "form-label" %>
        <%= f.date_field :start_date, value: params[:start_date], class: "form-control" %>
      </div>

      <div class="col-md-3">
        <%= f.label :end_date, "End Date", class: "form-label" %>
        <%= f.date_field :end_date, value: params[:end_date], class: "form-control" %>
      </div>

      <div class="col-md-3 d-flex align-items-end">
        <%= f.submit "Filter", class: "btn btn-primary me-2" %>
        <%= link_to "Clear", monitoring_sessions_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Sessions Table -->
<div class="card">
  <div class="card-body">
    <% if @sessions.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Session ID</th>
              <th class="text-center">Traces</th>
              <th class="text-center">Completed</th>
              <th class="text-center">Errors</th>
              <th>First Activity</th>
              <th>Last Activity</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @sessions.each do |session| %>
              <%= render "session_row", session: session %>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="mt-3">
        <%= paginate @sessions %>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
        <p class="text-muted mt-3">No sessions found</p>
        <% if params.values.any?(&:present?) %>
          <%= link_to "Clear filters", monitoring_sessions_path, class: "btn btn-outline-primary" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

