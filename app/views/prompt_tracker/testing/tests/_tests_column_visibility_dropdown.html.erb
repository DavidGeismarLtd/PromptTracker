<% testable = tests.first&.testable || testable_param %>

<div class="dropdown">
  <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="bi bi-eye"></i> Columns
  </button>
  <ul class="dropdown-menu dropdown-menu-end p-3" style="min-width: 250px;" onclick="event.stopPropagation();">
    <li class="mb-2">
      <strong class="dropdown-header px-0">Show/Hide Columns</strong>
    </li>
    <li><hr class="dropdown-divider"></li>
    
    <% testable.test_table_headers.each do |header| %>
      <li class="form-check mb-2">
        <input class="form-check-input" 
               type="checkbox" 
               id="col-<%= header[:key] %>" 
               data-column-visibility-target="checkbox" 
               data-column-name="<%= header[:key] %>" 
               data-action="change->column-visibility#toggle" 
               checked>
        <label class="form-check-label" for="col-<%= header[:key] %>">
          <%= header[:label] %>
        </label>
      </li>
    <% end %>
    
    <li><hr class="dropdown-divider"></li>
    <li class="d-flex gap-2">
      <button class="btn btn-sm btn-outline-primary flex-fill" data-action="click->column-visibility#showAll">Show All</button>
      <button class="btn btn-sm btn-outline-secondary flex-fill" data-action="click->column-visibility#hideAll">Hide All</button>
    </li>
  </ul>
</div>

