<div class="col-md-6 col-lg-4 mb-4">
  <div class="card h-100">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-database"></i> <%= dataset.name %>
      </h5>
      <% if !dataset.schema_valid? %>
        <span class="badge bg-danger" title="Schema no longer matches">
          <i class="bi bi-exclamation-triangle"></i> Invalid
        </span>
      <% end %>
    </div>
    <div class="card-body">
      <% if dataset.description.present? %>
        <p class="text-muted small"><%= dataset.description %></p>
      <% end %>

      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-muted small">Rows</span>
          <span class="badge bg-primary"><%= dataset.row_count %></span>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted small">Variables</span>
          <span class="badge bg-secondary"><%= dataset.variable_names.count %></span>
        </div>
      </div>

      <%# Schema-driven variable display - works for any testable type %>
      <% if dataset.variable_names.any? %>
        <div class="mb-3">
          <small class="text-muted d-block mb-1">Variables:</small>
          <div class="d-flex flex-wrap gap-1">
            <% dataset.variable_names.first(5).each do |var_name| %>
              <span class="badge bg-light text-dark"><%= var_name %></span>
            <% end %>
            <% if dataset.variable_names.count > 5 %>
              <span class="badge bg-light text-dark">+<%= dataset.variable_names.count - 5 %> more</span>
            <% end %>
          </div>
        </div>
      <% end %>

      <small class="text-muted">
        Created <%= time_ago_in_words(dataset.created_at) %> ago
        <% if dataset.created_by.present? %>
          by <%= dataset.created_by %>
        <% end %>
      </small>
    </div>
    <div class="card-footer">
      <div class="d-flex gap-2">
        <%= link_to dataset_path(dataset), class: "btn btn-sm btn-primary flex-grow-1" do %>
          <i class="bi bi-eye"></i> View
        <% end %>
        <%= link_to dataset_path(dataset, action: :edit), class: "btn btn-sm btn-outline-secondary" do %>
          <i class="bi bi-pencil"></i>
        <% end %>
        <%= button_to dataset_path(dataset, action: :destroy),
                      method: :delete,
                      class: "btn btn-sm btn-outline-danger",
                      data: { confirm: "Delete this dataset? This will also delete all #{dataset.row_count} rows." } do %>
          <i class="bi bi-trash"></i>
        <% end %>
      </div>
    </div>
  </div>
</div>

