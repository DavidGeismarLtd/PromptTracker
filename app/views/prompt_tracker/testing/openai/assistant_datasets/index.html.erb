<% content_for :breadcrumbs do %>
  <li class="breadcrumb-item"><%= link_to "OpenAI Assistants", testing_openai_assistants_path %></li>
  <li class="breadcrumb-item"><%= link_to @assistant.name, testing_openai_assistant_path(@assistant) %></li>
  <li class="breadcrumb-item active">Datasets</li>
<% end %>

<div class="row mb-4">
  <div class="col">
    <h1>
      <i class="bi bi-database"></i> Datasets for <%= @assistant.name %>
    </h1>
    <p class="text-muted">Manage test datasets for this assistant</p>
  </div>
  <div class="col-auto">
    <%= link_to new_testing_openai_assistant_dataset_path(@assistant), class: "btn btn-primary" do %>
      <i class="bi bi-plus-circle"></i> New Dataset
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @datasets.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Rows</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @datasets.each do |dataset| %>
              <tr>
                <td>
                  <strong><%= link_to dataset.name, testing_openai_assistant_dataset_path(@assistant, dataset) %></strong>
                </td>
                <td>
                  <% if dataset.description.present? %>
                    <%= truncate(dataset.description, length: 80) %>
                  <% else %>
                    <span class="text-muted">No description</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-secondary"><%= dataset.row_count %> rows</span>
                </td>
                <td>
                  <small class="text-muted"><%= time_ago_in_words(dataset.created_at) %> ago</small>
                </td>
                <td>
                  <%= link_to "View", testing_openai_assistant_dataset_path(@assistant, dataset), class: "btn btn-sm btn-outline-primary" %>
                  <%= link_to "Edit", edit_testing_openai_assistant_dataset_path(@assistant, dataset), class: "btn btn-sm btn-outline-secondary" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-database" style="font-size: 3rem; color: #ccc;"></i>
        <p class="text-muted mt-3">No datasets yet.</p>
        <p class="text-muted">Datasets contain test scenarios (interlocutor simulation prompts and conversation parameters) for running tests.</p>
        <%= link_to "Create your first dataset", new_testing_openai_assistant_dataset_path(@assistant), class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
