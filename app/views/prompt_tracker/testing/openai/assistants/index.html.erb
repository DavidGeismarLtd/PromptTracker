<% content_for :breadcrumbs do %>
  <li class="breadcrumb-item"><%= link_to "Testing", testing_root_path %></li>
  <li class="breadcrumb-item active">OpenAI Assistants</li>
<% end %>

<div class="row mb-4">
  <div class="col">
    <h1>
      <i class="bi bi-robot"></i> OpenAI Assistants
      <span class="badge bg-secondary"><%= @assistants.total_count %></span>
    </h1>
    <p class="text-muted">Manage and test OpenAI Assistants</p>
  </div>
  <div class="col-auto">
    <%= link_to new_testing_openai_assistant_path, class: "btn btn-primary" do %>
      <i class="bi bi-plus-circle"></i> Add Assistant
    <% end %>
  </div>
</div>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: testing_openai_assistants_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-5">
        <%= f.label :q, "Search", class: "form-label" %>
        <%= f.text_field :q, value: params[:q], class: "form-control", placeholder: "Search by name or description..." %>
      </div>

      <div class="col-md-3">
        <%= f.label :category, "Category", class: "form-label" %>
        <%= f.select :category, options_for_select([["All", ""]] + @categories.map { |c| [c.titleize, c] }, params[:category]), {}, class: "form-select" %>
      </div>

      <div class="col-md-4">
        <%= f.label :sort, "Sort By", class: "form-label" %>
        <%= f.select :sort, options_for_select([["Recent", ""], ["Name", "name"], ["Tests", "tests"]], params[:sort]), {}, class: "form-select" %>
      </div>

      <div class="col-12">
        <%= f.submit "Apply Filters", class: "btn btn-primary" %>
        <%= link_to "Clear", testing_openai_assistants_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Assistants Table -->
<div class="card">
  <div class="card-body">
    <% if @assistants.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Category</th>
              <th>Model</th>
              <th>Tests</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @assistants.each do |assistant| %>
              <tr>
                <td>
                  <strong><%= link_to assistant.name, testing_openai_assistant_path(assistant) %></strong>
                  <br>
                  <small class="text-muted"><%= assistant.assistant_id %></small>
                </td>
                <td><%= truncate(assistant.description, length: 80) %></td>
                <td>
                  <% if assistant.category.present? %>
                    <span class="badge bg-info"><%= assistant.category.titleize %></span>
                  <% end %>
                </td>
                <td>
                  <% if assistant.model.present? %>
                    <code class="text-muted"><%= assistant.model %></code>
                  <% else %>
                    <span class="text-muted">Not synced</span>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-secondary"><%= assistant.tests.count %></span>
                </td>
                <td>
                  <%= link_to "View", testing_openai_assistant_path(assistant), class: "btn btn-sm btn-outline-primary" %>
                  <%= link_to "Edit", edit_testing_openai_assistant_path(assistant), class: "btn btn-sm btn-outline-secondary" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="mt-3">
        <%= paginate @assistants %>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-robot" style="font-size: 3rem; color: #ccc;"></i>
        <p class="text-muted mt-3">No assistants found.</p>
        <%= link_to "Add your first assistant", new_testing_openai_assistant_path, class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
